---
phase: 12-movie-data-system
plan: 03
type: execute
wave: 3
depends_on: ["12-01", "12-02"]
files_modified:
  - test/unit/test_movie_data.gd
autonomous: true

must_haves:
  truths:
    - "MovieResource serialization is verified by automated tests"
    - "MovieGenerator variety is verified by automated tests"
    - "MoviePool persistence is verified by automated tests"
  artifacts:
    - path: "test/unit/test_movie_data.gd"
      provides: "Unit tests for movie data system"
      min_lines: 80
  key_links:
    - from: "test_movie_data.gd"
      to: "MovieResource, MovieGenerator, MoviePool"
      via: "test assertions"
      pattern: "assert_"
---

<objective>
Create unit tests verifying the movie data system works correctly.

Purpose: Ensure THTR-03 and THTR-04 requirements are met with automated verification.
Output: Comprehensive unit tests for MovieResource, MovieGenerator, and MoviePool.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan outputs
@.planning/phases/12-movie-data-system/12-01-SUMMARY.md
@.planning/phases/12-movie-data-system/12-02-SUMMARY.md

# Test pattern reference
@test/unit/test_timer_state.gd
@test/unit/test_room_state_machine.gd
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create movie data unit tests</name>
  <files>test/unit/test_movie_data.gd</files>
  <action>
Create test file following existing test patterns (test_timer_state.gd, test_room_state_machine.gd).

Test file structure:
```gdscript
extends GutTest

# MovieResource Tests
func test_movie_resource_default_values():
func test_movie_resource_to_dict():
func test_movie_resource_from_dict():
func test_movie_resource_from_dict_with_defaults():
func test_movie_resource_round_trip():

# MovieGenerator Tests
func test_generator_creates_movie():
func test_generator_produces_varied_titles():
func test_generator_produces_varied_genres():
func test_generator_rating_in_range():
func test_generator_duration_in_range():
func test_generator_unique_ids():
func test_generator_seeded_reproducibility():
func test_generator_pool_default_size():
func test_generator_pool_custom_size():

# MoviePool Tests
func test_pool_add_movie():
func test_pool_remove_movie():
func test_pool_get_movie():
func test_pool_size():
func test_pool_to_dict():
func test_pool_from_dict():
func test_pool_round_trip():
```

Test implementations:

**MovieResource Tests:**

1. `test_movie_resource_default_values`:
   - Create MovieResource.new()
   - Assert rating == 50, duration == 90

2. `test_movie_resource_to_dict`:
   - Create movie with all fields set
   - Call to_dict()
   - Assert dict has all 5 keys with correct values

3. `test_movie_resource_from_dict`:
   - Create dict with all fields
   - Call MovieResource.from_dict(dict)
   - Assert all fields match

4. `test_movie_resource_from_dict_with_defaults`:
   - Call from_dict with empty dict {}
   - Assert defaults are applied (title="Unknown", genre="Drama", etc.)

5. `test_movie_resource_round_trip`:
   - Create movie, to_dict, from_dict
   - Assert all fields equal

**MovieGenerator Tests:**

6. `test_generator_creates_movie`:
   - gen.generate_movie() returns MovieResource
   - Assert movie.id is not empty
   - Assert movie.title is not empty

7. `test_generator_produces_varied_titles`:
   - Generate 10 movies
   - Collect titles in array
   - Assert at least 5 unique titles (some variation expected)

8. `test_generator_produces_varied_genres`:
   - Generate 20 movies
   - Collect genres
   - Assert at least 3 unique genres

9. `test_generator_rating_in_range`:
   - Generate 50 movies
   - Assert all ratings between 30 and 100 inclusive

10. `test_generator_duration_in_range`:
    - Generate 50 movies
    - Assert all durations between 80 and 180 inclusive

11. `test_generator_unique_ids`:
    - Generate 10 movies
    - Assert all IDs are unique

12. `test_generator_seeded_reproducibility`:
    - Create two generators, both set_seed(12345)
    - Generate 3 movies from each
    - Assert movies have identical titles, genres, ratings, durations

13. `test_generator_pool_default_size`:
    - Call generate_pool() with no args
    - Assert size between 5 and 8 inclusive

14. `test_generator_pool_custom_size`:
    - Call generate_pool(10)
    - Assert size == 10

**MoviePool Tests:**

15. `test_pool_add_movie`:
    - Create pool, add movie
    - Assert pool.size() == 1

16. `test_pool_remove_movie`:
    - Add movie, remove by ID
    - Assert pool.size() == 0
    - Assert remove returns true
    - Assert remove of nonexistent ID returns false

17. `test_pool_get_movie`:
    - Add movie, get by ID
    - Assert returned movie has same ID
    - Assert get nonexistent returns null

18. `test_pool_size`:
    - Add 5 movies, assert size == 5

19. `test_pool_to_dict`:
    - Add 3 movies, call to_dict()
    - Assert dict has "movies" key
    - Assert movies array has 3 entries

20. `test_pool_from_dict`:
    - Create dict with movies array
    - Call MoviePool.from_dict()
    - Assert pool.size() matches array length

21. `test_pool_round_trip`:
    - Create pool with 5 movies
    - to_dict() -> from_dict()
    - Assert all movies preserved (check IDs)
  </action>
  <verify>
Run tests:
```bash
godot --headless --path . -s addons/gut/gut_cmdln.gd -gdir=res://test/unit -ginclude_subdirs -gtest=test_movie_data.gd
```
All 21 tests should pass.
  </verify>
  <done>
21 unit tests pass, covering MovieResource serialization, MovieGenerator variety and reproducibility, MoviePool storage and persistence. Test coverage validates THTR-03 (movie data model) and THTR-04 (movie pool) requirements.
  </done>
</task>

</tasks>

<verification>
1. Test file exists at test/unit/test_movie_data.gd
2. All tests pass when run with GUT
3. No test failures or errors
4. Tests cover all public methods of MovieResource, MovieGenerator, MoviePool
</verification>

<success_criteria>
- [ ] test_movie_data.gd exists at test/unit/test_movie_data.gd
- [ ] All 21 tests pass
- [ ] Tests cover MovieResource serialization
- [ ] Tests cover MovieGenerator variety
- [ ] Tests cover MoviePool persistence
- [ ] Tests verify seeded reproducibility
</success_criteria>

<output>
After completion, create `.planning/phases/12-movie-data-system/12-03-SUMMARY.md`
</output>
