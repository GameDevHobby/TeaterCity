---
phase: 01-room-manager-foundation
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/room_building/RoomBuildUI.gd
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Mouse clicks pass through RoomBuildUI to reach Area2D input_event"
    - "Room selection works when clicking on completed rooms"
    - "Build mode input handling still works (uses _input, not affected by mouse_filter)"
  artifacts:
    - path: "scripts/room_building/RoomBuildUI.gd"
      provides: "mouse_filter = MOUSE_FILTER_IGNORE in _ready()"
      contains: ["MOUSE_FILTER_IGNORE"]
---

<objective>
Fix room selection by setting mouse_filter = MOUSE_FILTER_IGNORE on RoomBuildUI Control node.

Root cause: RoomBuildUI covers the entire screen (anchors_preset=15/FULL_RECT) with default mouse_filter=MOUSE_FILTER_STOP, which blocks Area2D input_event signals from being triggered.

Output: Clicking on completed rooms triggers selection and shows yellow highlight.
</objective>

<context>
Debug session: .planning/debug/room-selection-post-fix.md
UAT gap: Test 2 - "still doesn't seem to do anything" after 01-03 fix

Godot behavior: Control nodes with MOUSE_FILTER_STOP consume mouse events before they reach Area2D.input_event signals. Setting MOUSE_FILTER_IGNORE allows events to pass through.

RoomBuildUI uses _input() for its input handling, which is NOT affected by mouse_filter - it will continue to work.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add mouse_filter = MOUSE_FILTER_IGNORE to RoomBuildUI._ready()</name>
  <files>scripts/room_building/RoomBuildUI.gd</files>
  <action>
Add `mouse_filter = Control.MOUSE_FILTER_IGNORE` at the start of the `_ready()` function in RoomBuildUI.gd.

Find the _ready() function and add the mouse_filter line as the first statement:

```gdscript
func _ready() -> void:
	mouse_filter = Control.MOUSE_FILTER_IGNORE  # Allow Area2D input_event to receive clicks
	# ... rest of existing _ready() code
```

This allows mouse events to pass through the RoomBuildUI Control to reach the Area2D nodes created by RoomManager for room selection.
  </action>
  <verify>
Run the game with `godot --path .`
Build a room to completion.
Click on the completed room.
Should see "Room selected: room_X" in console and yellow highlight appear.
  </verify>
  <done>
Mouse clicks pass through RoomBuildUI to Area2D, room selection works.
  </done>
</task>

</tasks>

<verification>
1. Run the game on desktop
2. Build a room to completion (draw box, place door, confirm)
3. Exit build mode
4. Click on the completed room
5. Verify: Console prints "Room selected: room_X"
6. Verify: Yellow highlight appears on room tiles
7. Click outside room - highlight should clear
8. Enter build mode, verify drawing boxes still works (mouse_filter doesn't break _input)
</verification>

<success_criteria>
1. Clicking on completed rooms triggers selection (console output + highlight)
2. Build mode still works (box drawing, door placement)
3. All UAT tests 2-6 can now be verified
</success_criteria>

<output>
After completion, create `.planning/phases/01-room-manager-foundation/01-04-SUMMARY.md`
</output>
