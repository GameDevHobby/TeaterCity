---
phase: 10-testing-verification
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - test/unit/test_navigation_operation.gd
autonomous: true

must_haves:
  truths:
    - "NavigationOperation identifies interior tiles correctly"
    - "NavigationOperation treats doors as walkable"
    - "NavigationOperation treats walls as non-walkable"
  artifacts:
    - path: "test/unit/test_navigation_operation.gd"
      provides: "Unit tests for NavigationOperation navigation mesh logic"
      min_lines: 60
  key_links:
    - from: "test/unit/test_navigation_operation.gd"
      to: "scripts/room_building/operations/NavigationOperation.gd"
      via: "instantiation and method calls"
      pattern: "NavigationOperation\\.new\\(\\)|update_room_navigation|clear_room_navigation"
---

<objective>
Create unit tests for NavigationOperation logic.

Purpose: TEST-01 requires unit tests for room editing operations. NavigationOperation handles setting walkable/non-walkable tiles for room navigation mesh. Tests verify correct tile classification without requiring actual TileMapLayer.

Output: `test/unit/test_navigation_operation.gd` with navigation logic tests.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-testing-verification/10-RESEARCH.md

# Reference implementation
@scripts/room_building/operations/NavigationOperation.gd

# Test patterns to follow
@test/unit/test_collision_operation.gd
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create test_navigation_operation.gd with tile classification tests</name>
  <files>test/unit/test_navigation_operation.gd</files>
  <action>
Create unit test file. NOTE: NavigationOperation's update_room_navigation() and clear_room_navigation() directly modify TileMapLayer which is difficult to unit test. We can:

1. Test the constants are correct (SOURCE_ID, WALKABLE_TILE, WALL_TILE)
2. Test _ui_to_tilemap_coords() if it doesn't require a real tilemap
3. Test the LOGIC by verifying what tiles would be set based on room data

Since the operation directly calls tilemap.set_cell(), we'll test indirectly by:
- Verifying room.walls correctly identifies wall positions
- Verifying room.doors correctly identifies door positions
- Verifying the operation can be instantiated and has expected methods

Test structure:
```gdscript
extends GutTest

var _nav_op: NavigationOperation
var _wall_op: WallOperation

func before_each() -> void:
    _nav_op = NavigationOperation.new()
    _wall_op = WallOperation.new()

func after_each() -> void:
    _nav_op = null
    _wall_op = null

func _create_room_with_walls_and_door(box: Rect2i, door_pos: Vector2i, door_dir: int) -> RoomInstance:
    var room = RoomInstance.new("test_room", "test_type")
    room.bounding_box = box
    room.walls = _wall_op.generate_walls(box)
    room.add_door(door_pos, door_dir)
    return room
```

Tests:
- `test_can_instantiate()` - NavigationOperation.new() works
- `test_constants_defined()` - SOURCE_ID, WALKABLE_TILE, WALL_TILE exist
- `test_interior_tiles_count()` - verify number of interior tiles in a room (bounding_box minus walls)
- `test_door_position_in_walls()` - verify door position is part of walls array
- `test_walkable_tile_coordinates()` - verify WALKABLE_TILE constant is Vector2i(0, 1)
- `test_wall_tile_coordinates()` - verify WALL_TILE constant is Vector2i(0, 0)

Note: Full integration of update_room_navigation() is tested in integration tests with actual TileMapLayer. Unit tests focus on the data/constants that the operation uses.

If NavigationOperation has any pure logic methods (no tilemap dependency), add tests for those.
  </action>
  <verify>
Run: `godot --headless --script addons/gut/gut_cmdln.gd -gtest=res://test/unit/test_navigation_operation.gd`

All tests should pass.
  </verify>
  <done>
- NavigationOperation can be instantiated
- Constants are verified (SOURCE_ID=1, WALKABLE_TILE=Vector2i(0,1), WALL_TILE=Vector2i(0,0))
- Room data structures (walls, doors) work correctly with navigation logic
- All tests pass
  </done>
</task>

</tasks>

<verification>
```bash
# Run navigation operation tests
godot --headless --script addons/gut/gut_cmdln.gd -gtest=res://test/unit/test_navigation_operation.gd

# Verify test file exists
grep -c "func test_" test/unit/test_navigation_operation.gd
```
</verification>

<success_criteria>
1. test_navigation_operation.gd exists with 5+ test methods
2. All tests pass when run with GUT
3. Constants verified against expected values
4. Room data integration verified (walls, doors)
5. No TileMapLayer dependency in unit tests
</success_criteria>

<output>
After completion, create `.planning/phases/10-testing-verification/10-03-SUMMARY.md`
</output>
