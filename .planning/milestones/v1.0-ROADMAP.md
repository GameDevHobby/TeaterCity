# Milestone v1.0: Room Editor

**Status:** SHIPPED 2026-02-08
**Phases:** 1-10
**Total Plans:** 41

## Overview

This roadmap transforms the existing room building system into a full room editor with selection, editing, furniture management, and persistence. Phases are derived from natural delivery boundaries in the requirements, with research recommendations incorporated. Room resize is included per PROJECT.md but flagged as high complexity requiring careful planning.

## Phases

### Phase 1: Room Manager Foundation

**Goal**: Establish the infrastructure to track completed rooms and enable selection.
**Depends on**: None (foundation phase)
**Plans**: 4 plans

Plans:
- [x] 01-01-PLAN.md - RoomManager singleton with Area2D selection and tap detection
- [x] 01-02-PLAN.md - Selection highlight visual and system integration
- [x] 01-03-PLAN.md - Desktop mouse input fix (gap closure)
- [x] 01-04-PLAN.md - RoomBuildUI mouse filter fix (gap closure)

**Details:**
- Requirements: SEL-01, SEL-02
- Risk Flags: MEDIUM (touch conflicts with camera), LOW (well-documented patterns)
- Research Notes: RoomManager autoload singleton, Area2D + CollisionShape2D for hit detection

---

### Phase 2: Room Menu & Edit Mode Entry

**Goal**: Players can access room editing options through a contextual menu.
**Depends on**: Phase 1 (room selection required)
**Plans**: 1 plan

Plans:
- [x] 02-01-PLAN.md - RoomEditMenu Control with contextual buttons and positioning

**Details:**
- Requirements: SEL-03, SEL-04
- Risk Flags: LOW (standard UI pattern)
- Research Notes: PanelContainer for custom styling, IsometricMath for positioning

---

### Phase 3: Persistence Infrastructure

**Goal**: Room data survives game quit/restart with safe save mechanics.
**Depends on**: Phase 1 (RoomManager must exist to track rooms)
**Plans**: 4 plans

Plans:
- [x] 03-01-PLAN.md - RoomInstance serialization (to_dict/from_dict methods)
- [x] 03-02-PLAN.md - RoomSerializer atomic JSON file I/O
- [x] 03-03-PLAN.md - Auto-save integration and load on startup
- [x] 03-04-PLAN.md - Visual restoration and human verification

**Details:**
- Requirements: PER-01, PER-02, PER-03, PER-04
- Risk Flags: HIGH (save corruption), MEDIUM (coordinate confusion, versioning)
- Research Notes: Atomic writes with temp file + rename, 5s debounce auto-save

---

### Phase 4: Furniture Selection

**Goal**: Players can select furniture for editing through multiple input methods.
**Depends on**: Phase 2 (edit mode entry required)
**Plans**: 2 plans

Plans:
- [x] 04-01-PLAN.md - FurnitureEditController with tap selection and cyan highlight
- [x] 04-02-PLAN.md - FurnitureListPanel with bi-directional selection sync

**Details:**
- Requirements: FUR-01, FUR-02
- Risk Flags: MEDIUM (touch target size), LOW (standard pattern)
- Research Notes: Dual selection (tap + list) for accessibility

---

### Phase 5: Furniture Editing Operations

**Goal**: Players can move, add, and delete furniture within rooms.
**Depends on**: Phase 4 (furniture selection required), Phase 3 (persistence)
**Plans**: 6 plans

Plans:
- [x] 05-01-PLAN.md - Drag-to-move with tap detection and collision validation
- [x] 05-02-PLAN.md - Move drag preview visual feedback
- [x] 05-03-PLAN.md - Delete operation with room type validation
- [x] 05-04-PLAN.md - Add operation with furniture picker and placement mode
- [x] 05-05-PLAN.md - Add placement preview and RoomBuildController accessors
- [x] 05-06-PLAN.md - Human verification of all furniture operations

**Details:**
- Requirements: FUR-03, FUR-04, FUR-05, OVR-02, OVR-03
- Risk Flags: MEDIUM (visual cleanup, room type validation, mobile drag)
- Research Notes: Reuse FurnitureOperation and CollisionOperation

---

### Phase 6: Door Editing

**Goal**: Players can add and remove doors from existing rooms.
**Depends on**: Phase 2 (edit mode entry required), Phase 3 (persistence)
**Plans**: 5 plans

Plans:
- [x] 06-01-PLAN.md - DoorEditController state machine and RoomManager tile occupancy helper
- [x] 06-02-PLAN.md - DoorOperation edit validation and door add operation
- [x] 06-03-PLAN.md - Door removal with wall restoration and validation
- [x] 06-04-PLAN.md - DoorEditHighlight visual and Main.gd integration
- [x] 06-05-PLAN.md - Human verification of door editing workflow

**Details:**
- Requirements: DOOR-01, DOOR-02, DOOR-03
- Risk Flags: MEDIUM (navigation mesh update), LOW (reuses existing logic)
- Research Notes: Adjacent tile occupancy check for door validation

---

### Phase 7: Room Deletion

**Goal**: Players can remove unwanted rooms with proper cleanup.
**Depends on**: Phase 3 (persistence), Phase 6 (door handling)
**Plans**: 3 plans

Plans:
- [x] 07-01-PLAN.md - RoomManager unregister_room() and DeletionOperation infrastructure
- [x] 07-02-PLAN.md - RoomEditMenu delete button with ConfirmationDialog and Main.gd wiring
- [x] 07-03-PLAN.md - Human verification of room deletion workflow

**Details:**
- Requirements: EDIT-04, EDIT-05
- Risk Flags: HIGH (navigation targets, navigation mesh), MEDIUM (shared walls)
- Research Notes: Sequence: clear navigation -> unregister -> delete visuals

---

### Phase 8: Room Resize (Complex)

**Goal**: Players can resize existing rooms by adjusting walls using delete-and-rebuild approach.
**Depends on**: Phase 7 (room deletion), Phase 5 (furniture validation)
**Plans**: 5 plans

Plans:
- [x] 08-01-PLAN.md - ResizeOperation validation (furniture bounds, room overlap, size constraints)
- [x] 08-02-PLAN.md - RoomResizeController state machine and box drawing input
- [x] 08-03-PLAN.md - RoomResizeHighlight preview rendering
- [x] 08-04-PLAN.md - RoomEditMenu resize button and Main.gd integration
- [x] 08-05-PLAN.md - Human verification of resize workflow

**Details:**
- Requirements: EDIT-01, EDIT-02, EDIT-03, OVR-01
- Risk Flags: HIGH (complexity, furniture invalidation, shared walls), MEDIUM (UI/UX)
- Research Notes: Delete+rebuild reuses 80%+ existing code, box drawing for mobile

---

### Phase 9: Admin Menu & Feature Flags

**Goal**: Admin tools for save management, gated behind feature flags.
**Depends on**: Phase 3 (persistence must exist)
**Plans**: 3 plans

Plans:
- [x] 09-01-PLAN.md - AdminMenu autoload singleton with feature flag detection
- [x] 09-02-PLAN.md - AdminMenuUI with hotkey toggle and confirmation dialogs
- [x] 09-03-PLAN.md - Visual cleanup integration and human verification

**Details:**
- Requirements: PER-05
- Risk Flags: LOW (standard patterns)
- Research Notes: OS.has_feature("debug") + ProjectSettings flag, tilde hotkey

---

### Phase 10: Testing & Verification

**Goal**: Comprehensive test coverage for all room editor features.
**Depends on**: All previous phases
**Plans**: 8 plans

Plans:
- [x] 10-01-PLAN.md - Unit tests for ResizeOperation validation logic
- [x] 10-02-PLAN.md - Unit tests for DeletionOperation shared wall detection
- [x] 10-03-PLAN.md - Unit tests for NavigationOperation tile classification
- [x] 10-04-PLAN.md - Unit tests for FurnitureOperation visual creation
- [x] 10-05-PLAN.md - Unit tests for RoomSerializer save/load happy paths
- [x] 10-06-PLAN.md - Unit tests for RoomSerializer edge cases
- [x] 10-07-PLAN.md - Integration tests for furniture edit workflows
- [x] 10-08-PLAN.md - Integration tests for deletion and persistence workflows

**Details:**
- Requirements: TEST-01, TEST-02, TEST-03, TEST-04
- Risk Flags: MEDIUM (integration test complexity), LOW (GUT framework)
- Research Notes: Follow existing patterns, actual file I/O with cleanup

---

## Milestone Summary

**Key Decisions:**
- Delete+rebuild for resize: Simpler than in-place wall modification; reuses existing WallOperation
- Area2D for room selection: Handles isometric diamond shapes better than rect collision
- Stateless operation classes: Easy to test, no side effects, follows existing patterns
- Block resize if furniture invalidated: Simpler UX than auto-moving furniture
- Reset doors on resize: Walls change shape, easier to re-place doors
- Doors to empty space only: Prevents confusing room-to-room connections
- Auto-save with admin reset: Reduces friction vs explicit save
- Both tap and list for furniture selection: Accessibility and discoverability

**Issues Resolved:**
- Touch conflicts with camera pan: Toggle camera.enable_pinch_pan during edit mode
- Save file corruption on mobile: Atomic writes with temp file + rename
- Shared wall handling during resize/delete: DeletionOperation.get_deletable_walls()
- Navigation mesh updates: Explicit calls after door/room changes

**Issues Deferred:**
- None - all v1.0 requirements shipped

**Technical Debt Incurred:**
- None identified - audit passed with 0 tech debt items

---

_For current project status, see .planning/MILESTONES.md_

---

*Archived: 2026-02-08 as part of v1.0 milestone completion*
